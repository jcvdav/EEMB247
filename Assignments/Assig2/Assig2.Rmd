---
title: "Assignment 2"
subtitle: "Solutions to Linear Dynamical Systems in discrete and continuous time"
author: "Juan Carlos Villase√±or-Derbez"
date: "January 23, 2018"
output:
    bookdown::pdf_document2:
      toc: no
      fig_caption: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.height = 3, fig.width = 6)
```

```{r}
suppressPackageStartupMessages({
  library(deSolve)
  library(tidyverse)
})
```


# Discrete Time

Consider the system of linear discrete-time equations:

\begin{equation}
\begin{split} \label{eq:discrete_system}
x_{t+1} &= x_t + 0.5 y_t \\
y_{t+1} &= 0.5 x_t + y_t 
\end{split}
\end{equation}

 

with initial conditions:  
$x_0 = 0$  
$y_0 = 1$  

## Calculate and plot the *numerical solution* to Eq \ref{eq:discrete_system} with $t\in(0, 10)$

```{r}
X_0 <- 0 # Initial conditions for X
Y_0 <- 1 # Initial conditons for Y
nyears <- 10 #Number of years
time <- seq(0:nyears) #Vector of years
X <- rep(NULL, nyears + 1) #Pre-define vector of X
Y <- rep(NULL, nyears + 1) #Pre-define vctor of Y
X[1] <- X_0 #Assign initial conditions to the vectors
Y[1] <- Y_0 

# Iterate over years, calculating each state variable
for(i in 1:nyears){
  X[i + 1] <- X[i] + 0.5 * Y[i]
  Y[i + 1] <- 0.5 * X[i] + Y[i]
}
# Plot the solution
data.frame(time, X, Y) %>% 
  gather(Variable, Value, -time) %>% 
  ggplot(aes(x = time, y = Value, color = Variable)) +
  geom_line(size = 1) +
  geom_point(color = "black") +
  theme_classic() +
  scale_color_brewer(palette = "Set1") + theme(legend.position = c(0.1, 0.9))
```


## Calculate and plot the *analytical solution* to Eq \ref{eq:discrete_system} with $t\in(0, 10)$

In matrix form, Eq \ref{eq:discrete_system} can be written as:

\begin{equation}
\begin{bmatrix}
    X_{t+1}\\
    Y_{t+1}
\end{bmatrix}
=
A
\times 
\begin{bmatrix}
    X_{t}\\
    Y_{t}
\end{bmatrix}
\end{equation}

Where $A$ is the $2\times 2$ matrix:

$$
A =
\begin{bmatrix}
    1 & 0.5\\
    0.5 & 1
\end{bmatrix}
$$
Therefore, the system is:

$$
\begin{bmatrix}
    X_{t+1}\\
    Y_{t+1}
\end{bmatrix}
=
\begin{bmatrix}
    1 & 0.5\\
    0.5 & 1
\end{bmatrix}
\times 
\begin{bmatrix}
    X_t\\
    Y_t
\end{bmatrix}
$$
This particular system has a general solution of the form:

\begin{equation} \label{eq:solution_discrete}
\begin{bmatrix}
    X(t)\\
    Y(t)
\end{bmatrix}
= C_1\lambda_1^t\bar{v_1} + C_2\lambda_2^t\bar{v_2}
\end{equation}

Where $C_1$ and $C_2$ represent variables specific to the particular problem, based on the initial conditions. $\lambda_1$ and $\lambda_2$ are the eigenvalues of $A$, and $\bar{v_1}$ and $\bar{v_2}$ are the eigenvectors of $A$.


```{r}
A <- matrix(c(1, 0.5, 0.5, 1), nrow = 2)

lambda_1 <- eigen(A)$values[1]
lambda_2 <- eigen(A)$values[2]

v_1 <- eigen(A)$vectors[,1]

v_2 <- eigen(A)$vectors[,2]
```

The eigenvalues are $\lambda_1 = 1.5$ and $\lambda_2 = 0.5$. The eigenvectors are $\bar{v_1} = \begin{bmatrix}0.7071 \\ 0.7071\end{bmatrix}$, and $\bar{v_2} = \begin{bmatrix}-0.7071 \\0.7071\end{bmatrix}$.

Substituting these values into Eq \ref{eq:solution_discrete}, and simplifying we obtain:

\begin{equation} \label{eq:substituted}
\begin{split}
X(t) &= C_1(1.5)^t(1) + C_20.5^t(-1) \\
Y(t) &= C_1(1.5)^t(1) + C_20.5^t(1)
\end{split}
\end{equation}

Using the known initial conditions ($X(0) = 0$ and $Y(0) = 1$), we can evaluate Eq \ref{eq:substituted} at $t = 0$ and solve for $C_1$ and $C_2$. Solving the equation for state variable $N$:

\begin{equation}
\begin{split} \label{eq:discrete_X}
0 &= C_1(1.5)^0(1) + C_20.5^0(-1) \\
0 &= C_1(1)(1) + C_2(1)(-1) \\
0 &= C_1 - C_2 \\
C_1 &= C_2
\end{split}
\end{equation}


Substituting this in the equation for state variable $Y$:

\begin{equation}
\begin{split}
1 &= C_1(1.5)^0(1) + C_20.5^0(1) \\
1 &= C_1(1)(1) + C_2(1)(1) \\
1 &= C_1 + C_2 \\
1 &= C_2 + C_2 \\
1 & = 2C_2 \\
C_2 &= \frac{1}{2}
\end{split}
\end{equation}


Returning to Eq \ref{eq:discrete_X}, we obtain that $C_1 = \frac{1}{2}$

```{r}
C1 <- 0.5
C2 <- C1

t <- seq(0, nyears)

XY <- cbind(C1*(lambda_1^t)*1 + C2*(lambda_2^t)*(-1),
            C1*(lambda_1^t)*1 + C2*(lambda_2^t)*(1))

cbind(t, XY) %>% 
  as.data.frame() %>% 
  magrittr::set_colnames(c("time", "X", "Y")) %>% 
  gather(Variable, Value, -time) %>% 
  ggplot(aes(x = time, y = Value, color = Variable)) +
  geom_line(size = 1) +
  geom_point(color = "black") +
  theme_classic() +
  scale_color_brewer(palette = "Set1")
```

\clearpage

# Continuous Time

Consider the systems of linear ordinary differential equations:

\begin{equation}
\begin{split} \label{eq:cont_system}
\frac{dx}{dt} &= x + 0.5 y \\
\frac{dy}{dt} &= 0.5 x + y 
\end{split}
\end{equation}

with initial conditions:  
$x_0 = 0$  
$y_0 = 1$  

## Calculate and plot the *numerical solution* to Eq \ref{eq:cont_system} with $t\in(0, 10)$

```{r}
# Define a function to pass to lsoda
system <- function(t, values, params){
  
  x <- values[1]
  y <- values[2]
  
  a <- params[1]
  b <- params[2]
  c <- params[3]
  d <- params[4]
  
  dxdt <- a*x + b*y
  dydt <- c*x + d*y
  
  return(list(c(dxdt, dydt)))
}
```

```{r}
t <- seq(0, 10)
x_0 <- 0
Y_0 <- 1
initial_values <- c(X_0, Y_0)

a <- 1
b <- 0.5
c <- 0.5
d <- 1
params <- c(a, b, c, d)

lsoda(y = initial_values, times = t, func = system, parms = params) %>% 
  as.data.frame() %>% 
  magrittr::set_colnames(c("time", "X", "Y")) %>% 
  gather(Variable, Value, -time) %>% 
  ggplot(aes(x = time, y = Value, color = Variable)) +
  geom_line(size = 1) +
  geom_point(color = "black") +
  theme_classic() +
  scale_color_brewer(palette = "Set1") + theme(legend.position = c(0.1, 0.9))
```

## Calculate and plot the *analytical solution* to Eq \ref{eq:cont_system} with $t\in(0, 10)$





